<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Payment</title>
		<meta name="viewport" content="width=device-width, user-scalable=no" />
		<link href="libs/bs/bootstrap.css" rel="stylesheet">
		<link href="css/digipay.css" rel="stylesheet">
		<script type="text/javascript" src="libs/dgb/digibyte.js"></script>
		<script>
			
			
			var digibyte = require('digibyte');

		
		</script>
		
		<script type="text/javascript" src="libs/jq/jquery.min.js"></script>
		<script type="text/javascript" src="src/jquery.qr.js"></script>
		<script type="text/javascript" src="src/digipayclass.js"></script>
		<script type="text/javascript" src="src/digiObj.js"></script>
		<script type="text/javascript" src="src/jquery.digipay.js"></script>
		
		<link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
		<link rel="manifest" href="img/site.webmanifest">
		<link rel="mask-icon" href="img/safari-pinned-tab.svg" color="#5bbad5">
		<link rel="shortcut icon" href="img/favicon.ico">
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="msapplication-config" content="img/browserconfig.xml">
		<meta name="theme-color" content="#ffffff">
		
		
		
		
		<style>
			h1,h2,h3,h4,h5{
				text-align:center;
			}
			body{
				background-color:#333;
				text-align:center;
			}
			
			
			#wrapper{
				background-color:#FFF;
				max-width:1000px;
				margin:0 auto;
			
			}
			
		
			#digipay{
				max-width:500px;
				width:100%;

				margin:10px 0;
				display:inline-block;
				text-align:initial;
			}
			
			.options{
				background-color:#FFF;
				padding:10px;
				max-width:500px;
				margin:0 auto;
				
			}
			
			.options input{
			margin:5px;
			passing:5px;
			font-size:15px;
			text-align:center;
				width:100%;
			}
			
 			pre{
				display:block;
				max-width:400px;
				text-align:left;
			}
			
		</style>
	</head>
	
	<body>
		
		<div id="wrapper">

			<h2>Payment terminal</h2>
			<p>The blue element underneath is just a div with an id, that is instantiated by the DigiPay plugin</p>
			
			<div id="digipay"></div>
			<div class="options">
					
				<button id="abort" class="btn btn-primary">Abort</button>
				<button id="newtx" class="btn btn-primary">New tx</button>
				<div>
					<input type="text" id="address" placeholder="Insert DigiByte-address"/>
				</div>
				<div>
					<input type="number" step="0.0001" id="amount" placeholder="Insert amount in DGBs e.g. 1,04 for 1,04DGB"/>
				</div>
			</div>	
			
			<pre>
	
var dgp = $('#digipay').digipay({
	'fee':70000,
	
	// these functions event 
	// handlers can be changed
	'onSuccess':success,
	'onStatusUpdate':update,
	'onInitialize':init,
	'onNewPayment':newpay,
	//
	
	'requiredConfirmations' : 2,
	'onFail':failed,
})
			</pre>
			
			<pre>
$('#newtx').on('click',function() {
	var namount = digibyte.Unit.fromBTC(
		parseFloat(
			$('#amount').val())
		).toSatoshis() 
		|| 
		parseInt(Math.random()*100000+70000
	);
	$('#digipay').digipay({
		amount:namount,
		address:$('#address').val()
	}).newPayment(makeid(10));
	// id is optional.
});
			</pre>	
			
			
			
		</div>
	
	
		<script>
			
		
		
			
	
			var success = function (e) {
				console.log('succes',e);
				
				DGBO.getOpData(e.endTx.txid).then(result=>{console.log(result)});
			}
			var failed = function(e) {
				console.log('fail',e);
				
			}
			
			
			var newpay = function(e) {
				// fires after a payment is generated
				console.log(e);
				// this makes sure when you refresh accidentaly, it doesnt overwirte the pvk and data
				history.pushState('', '', '?ppk='+e.privateKey+'&data='+e.data+'&am='+e.amount+'&addr='+e.address);
				
			
			}
			
			var init = function(e) {
				
				
				// fires after initiation of the element
				
				
				
				
			}
			
			
			var update = function(e) {console.log(e);}
			
			var pvk = fgp('ppk');
			
			var data =  fgp('data') || makeid(10);
			
			var address = fgp('addr') || false;
			
			var amount = fgp('am') || false;
			
			
			// satoshi

			// returns the digipay class, not a jquery element
		
			var dgp = $('#digipay').digipay({
				'fee':70000,
				'onSuccess':success,
				'onStatusUpdate':update,
				'onInitialize':init,
				'onNewPayment':newpay,
				'requiredConfirmations' : 2,
				'onFail':failed,
			})
			
			if(address && pvk && data && amount) {
				
				dgp.setSettings({amount,address});
				dgp.newPayment(data,pvk);
			
			
			
			}
			
			
			
			
			// there is no pvk, it will generate a new one.
			
			
			$(window).resize(function() {
				dgp.resize();

				
			
			});
			

			
			
			$('#newtx').on('click',function() {
				var namount = digibyte.Unit.fromBTC(parseFloat($('#amount').val())).toSatoshis() || parseInt(Math.random()*100000+70000);
				$('#digipay').digipay({
					amount:namount,
					address:$('#address').val()
				}).newPayment(makeid(10));
				
			});
				
				
			$('#abort').on('click',function() {
			
				dgp.abort();
			
			});
				
				
				
				
				
			function makeid(l){ var t = "";var p = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<l;i++){t+=p.charAt(Math.floor(Math.random()*p.length))};return t;}
				
			function fgp(parameterName) {
			var result = null,
				tmp = [];
			var items = location.search.substr(1).split("&");
			for (var index = 0; index < items.length; index++) {
				tmp = items[index].split("=");
				if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
			}
			return result;}
			

		</script>
	</body>
</html>

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Payment</title>
		<meta name="viewport" content="width=device-width, user-scalable=no" />
		<link href="libs/bs/bootstrap.css" rel="stylesheet">
		<link href="css/digipay.css" rel="stylesheet">
		<script type="text/javascript" src="libs/dgb/digibyte.js"></script>
		<script>
			
			
			var digibyte = require('digibyte');

		
		</script>
		
		<script type="text/javascript" src="libs/jq/jquery.min.js"></script>
		<script type="text/javascript" src="src/jquery.qr.js"></script>
		<script type="text/javascript" src="src/digipayclass.js"></script>
		<script type="text/javascript" src="src/digiObj.js"></script>
		<script type="text/javascript" src="src/jquery.digipay.js"></script>
		
		<link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
		<link rel="manifest" href="img/site.webmanifest">
		<link rel="mask-icon" href="img/safari-pinned-tab.svg" color="#5bbad5">
		<link rel="shortcut icon" href="img/favicon.ico">
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="msapplication-config" content="img/browserconfig.xml">
		<meta name="theme-color" content="#ffffff">
		
		
		
		
		<style>
			h1,h2,h3,h4,h5{
				text-align:center;
			}
			body{
				background-color:#333;
				text-align:center;
			}
			
			
			#wrapper{
				background-color:#FFF;
				max-width:1000px;
				margin:0 auto;
			
			}
			
		
			#digipay{
				max-width:500px;
				width:100%;

				margin:10px 0;
				display:inline-block;
				text-align:initial;
			}
			
			.options{
				background-color:#FFF;
				padding:10px;
				max-width:500px;
				margin:0 auto;
				
			}
			
			.options input{
			margin:5px;
			passing:5px;
			font-size:15px;
			text-align:center;
				width:100%;
			}
			
 			pre{
				margin:0 auto;
				display:block;
				max-width:600px;
				text-align:left;
				padding:10px;
			}
			p{
				text-align:justify;
				display:block;
				margin:10px auto;
				max-width:600px;
				padding:10px;
			}
		</style>
	</head>
	
	<body>
		
		<div id="wrapper">

			<h2>Payment terminal</h2>
			
			<div id="digipay"></div>
			<div class="options">
					
				<button id="abort" class="btn btn-primary">Abort</button>
				<button id="newtx" class="btn btn-primary">New tx</button>
				<div>
					<input type="text" id="address" placeholder="Insert DigiByte-address"/>
				</div>
				<div>
					<input type="number" step="0.0001" id="amount" placeholder="Insert amount in DGBs e.g. 1,04 for 1,04DGB"/>
				</div>
			</div>	
			<h3>Initiation</h3>
			<pre><code>
		
var dgp = $('#digipay').digipay({
	'fee':70000,
	
	// these functions event 
	// handlers can be changed
	'onSuccess':success,
	'onStatusUpdate':update,
	'onInitialize':init,
	'onNewPayment':newpay,
	//
	
	'requiredConfirmations' : 2,
	'onFail':failed,
})			</code>
			</pre>
			<h3>Making a new payment</h3>
			<pre>
			<code>
$('#newtx').on('click',function() {
	var namount = digibyte.Unit.fromBTC(
		parseFloat($('#amount').val())).toSatoshis() 
		|| 
		parseInt(Math.random()*100000+70000
	);
	
	$('#digipay').digipay({
		amount:namount,
		address:$('#address').val()
	}).newPayment(makeid(10));
	// id is optional.
});			</code>
			</pre>	
			<h3>Introduction</h3>
			<p>
				This payment plugin makes it possible to accept DigiByte payments with only an internet connection. All you need is a public address and an amount. If you fill in an amount and address it will create an interface that will check if the payment has come through and it will redirect that payment to the specified address. This way the seller can check if the specified amount has been sent without the need to install a wallet on the device. Imagine being a seller with just a tablet or a smartphone. You sell your products and instead of accepting FIAT, you accept DigiByte. Because these payments require so little time, the transaction will be done within approximately 30 seconds on average. 
			</p>
			<h3>Why use this over a manual transaction method?</h3>
			<p>
				Because it doesn’t require a wallet to be synched to check the payment, you can accept payments redirected to a cold storage address. There is no need for the private key to be inserted into a hot wallet to check if payments have been done. You only need an internet connection. 
			</p>
			<p>
				Furthermore you don’t have to look at the screen of the buyer if the right amount of DigiByte have been sent. The script does this for you. Also this script will send an ID in the OP_RETURN value of the final payment which makes it easier to manage your sales. 
			</p>
		
			<h3>What are the downsides?</h3>
			<p>
				The downside is also an upside: It is all client side. This way you don’t need to set up an expensive server on which you have to rely in order to accept payments. You only need an internet connection. The risk is in a full client side payment method is in the buffer private and public key that are being stored in the GET values of the URI. 
			</p>
			
		</div>
	
	
		<script>
			
		
		
			
	
			var success = function (e) {
				console.log('succes',e);
				
				DGBO.getOpData(e.endTx.txid).then(result=>{console.log(result)});
			}
			var failed = function(e) {
				console.log('fail',e);
				
			}
			
			
			var newpay = function(e) {
				// fires after a payment is generated
				console.log(e);
				// this makes sure when you refresh accidentaly, it doesnt overwirte the pvk and data
				history.pushState('', '', '?ppk='+e.privateKey+'&data='+e.data+'&am='+e.amount+'&addr='+e.address);
				
			
			}
			
			var init = function(e) {
				
				
				// fires after initiation of the element
				
				
				
				
			}
			
			
			var update = function(e) {console.log(e);}
			
			var pvk = fgp('ppk');
			
			var data =  fgp('data') || makeid(10);
			
			var address = fgp('addr') || false;
			
			var amount = fgp('am') || false;
			
			
			// satoshi

			// returns the digipay class, not a jquery element
		
			var dgp = $('#digipay').digipay({
				'fee':70000,
				'onSuccess':success,
				'onStatusUpdate':update,
				'onInitialize':init,
				'onNewPayment':newpay,
				'requiredConfirmations' : 2,
				'onFail':failed,
			})
			
			if(address && pvk && data && amount) {
				
				dgp.setSettings({amount,address});
				dgp.newPayment(data,pvk);
			
			
			
			}
			
			
			
			
			// there is no pvk, it will generate a new one.
			
			
			$(window).resize(function() {
				dgp.resize();

				
			
			});
			

			
			
			$('#newtx').on('click',function() {
				var namount = digibyte.Unit.fromBTC(parseFloat($('#amount').val())).toSatoshis() || parseInt(Math.random()*100000+70000);
				$('#digipay').digipay({
					amount:namount,
					address:$('#address').val()
				}).newPayment(makeid(10));
				
			});
				
				
			$('#abort').on('click',function() {
			
				dgp.abort();
			
			});
				
				
				
				
				
			function makeid(l){ var t = "";var p = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<l;i++){t+=p.charAt(Math.floor(Math.random()*p.length))};return t;}
				
			function fgp(parameterName) {
			var result = null,
				tmp = [];
			var items = location.search.substr(1).split("&");
			for (var index = 0; index < items.length; index++) {
				tmp = items[index].split("=");
				if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
			}
			return result;}
			

		</script>
	</body>
</html>
